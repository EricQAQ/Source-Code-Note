# tinyhttpd workflow

## 主流程
1. 启动服务器, 创建socket, 自定义端口或者随机端口绑定httpd服务
2. 执行`accept()`函数，等待客户端的请求. 该函数是阻塞式的, 也就是说当没有请求到来的时候, 会block住
3. 当客户端请求到来, 并且`accept()`函数执行成功, 创建一个线程, 该线程会执行`accept_request()`函数

## 子流程
子流程主要在`accept_request()`函数中

1. 从传来的客户端socket描述字的缓冲区读取http请求的第一行数据(GET /xxxx ...)
2. 从第一步读取的数据中提取**请求方法**(只支持了GET和POST)
3. 从第一步读取的数据中提取**url**和**请求参数**
4. 在`tinyhttpd`中服务器文件是在`htdocs`文件夹下, 根据提取的url去找文件. 
	1. 如果文件可用，并且是无请求参数的GET请求，则直接返回对应的文件
	2. 如果文件可用，并且是POST请求或者有请求参数的GET请求，执行第五步

5. 如果是GET请求，调用cgi脚本
6. 如果是POST请求，先获取http请求头中的`Content-Length`，然后创建管道(用来进行进程间的通信)，然后fork一个子进程
7. 在子进程中，设置环境变量，然后执行cgi脚本
8. 在父进程中，读取http请求的body部分，然后写入管道中交给子进程；然后也会从管道中获得子进程写入的东西，再把这些东西发送给客户端